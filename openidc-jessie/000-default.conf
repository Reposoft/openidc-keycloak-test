<VirtualHost *:80>
	ServerAdmin webmaster@localhost
	DocumentRoot /var/www/html

	ErrorLog /proc/self/fd/1
	CustomLog /proc/self/fd/2 combined

	OIDCProviderMetadataURL http://keycloak:8080/auth/realms/Testrealm/.well-known/openid-configuration
	#OIDCRedirectURI http://openidc/oauth2callback
	OIDCRedirectURI http://openidc/protected/redirect_uri
	OIDCCryptoPassphrase 0123456789
	OIDCClientID testclient
	OIDCClientSecret 99f47cdf-089c-469b-a205-8e521cbcd6b7

	OIDCSessionType server-cache:persistent

	OIDCRemoteUserClaim email
	OIDCScope "openid email"
	OIDCPassClaimsAs environment

	Header setifempty Cache-Control "max-age=0, must-revalidate"

	# This is Keycloak's logout URL, see http://keycloak.github.io/docs/userguide/keycloak-server/html/ch08.html#d4e1398
	# with, as redirect_uri, the urlencoded OIDCRedirectURI from above
	# with ?logout=[final destination], also urlencoded so look for "%3F".
	# And if you want a query param for the destination page it's even more encoding...
	# See https://github.com/pingidentity/mod_auth_openidc/wiki#9-how-do-i-logout-users
	# Using a temp redirect so we can trust we get an apache log entry for every logout
	# This is non-trivial so we keep all the stages of encoding as documentation
	#RedirectTemp /logout http://keycloak:8080/auth/realms/Testrealm/protocol/openid-connect/logout?redirect_uri=http://openidc/protected/redirect_uri?logout=            http://openidc/?we-have-no-loggedout-page-yet
	#RedirectTemp /logout http://keycloak:8080/auth/realms/Testrealm/protocol/openid-connect/logout?redirect_uri=http%3A%2F%2Fopenidc%2Fprotected%2Fredirect_uri%3Flogout=http%3A%2F%2Fopenidc%2F%3Fwe-have-no-loggedout-page-yet
	RedirectTemp  /logout http://keycloak:8080/auth/realms/Testrealm/protocol/openid-connect/logout?redirect_uri=http%3A%2F%2Fopenidc%2Fprotected%2Fredirect_uri%3Flogout=http%253A%252F%252Fopenidc%252F%253Fwe-have-no-loggedout-page-yet

	<Location /protected>
		AuthType openid-connect
		Require valid-user
	</Location>

</VirtualHost>
